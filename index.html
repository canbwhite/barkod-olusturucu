<!DOCTYPE html>
<html lang="tr">
<head>
  <meta charset="UTF-8">
  <title>‚öôÔ∏è Control.json Editor</title>
  <style>
    body {
      font-family: Arial, sans-serif;
      background: #111;
      color: #eee;
      padding: 20px;
    }
    .hidden { display: none; }
    .box {
      border: 1px solid #333;
      padding: 15px;
      margin-bottom: 20px;
      border-radius: 8px;
    }
    label {
      display: block;
      margin: 5px 0;
    }
    button {
      padding: 10px;
      margin-top: 10px;
      cursor: pointer;
    }
  </style>
</head>
<body>

<h2>üîê Giri≈ü</h2>
<div id="loginBox" class="box">
  <input type="password" id="password" placeholder="≈ûifre">
  <button onclick="login()">Giri≈ü</button>
</div>

<div id="panel" class="hidden">

  <h2>‚öôÔ∏è Control.json Editor</h2>

  <div class="box">
    <label>
      <input type="checkbox" id="globalEnabled">
      Global Enabled
    </label>
  </div>

  <div class="box">
    <h3>ü§ñ Bot Toggle</h3>
    <div id="users"></div>
  </div>

  <div class="box">
    <h3>üîë Login Trigger</h3>
    <div id="tokens"></div>
  </div>

  <button onclick="save()">üíæ Kaydet</button>
</div>

<script>
/* ================== AYARLAR ================== */

const PASSWORD = "29ekim1923"; // panel ≈üifresi

const GITHUB_TOKEN = "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";

const OWNER = "canbwhite";
const REPO = "barkod-olusturucu";
const FILE_PATH = "control.json";
const BRANCH = "main";

/* ============================================= */

let data = {};
let fileSha = "";

/* ---------- LOGIN ---------- */
function login() {
  const pass = document.getElementById("password").value;
  if (pass !== PASSWORD) {
    alert("≈ûifre yanlƒ±≈ü");
    return;
  }
  document.getElementById("loginBox").classList.add("hidden");
  document.getElementById("panel").classList.remove("hidden");
  loadJson();
}

/* ---------- JSON OKU ---------- */
async function loadJson() {
  try {
    const apiUrl = `https://api.github.com/repos/${OWNER}/${REPO}/contents/${FILE_PATH}`;

    const res = await fetch(apiUrl, {
      headers: {
        Authorization: `token ${GITHUB_TOKEN}`
      }
    });

    if (!res.ok) {
      alert("JSON okunamadƒ±: " + res.status);
      return;
    }

    const json = await res.json();
    fileSha = json.sha;
    data = JSON.parse(atob(json.content));

    console.log("JSON OKUNDU:", data);

    document.getElementById("globalEnabled").checked = !!data.globalEnabled;

    const usersDiv = document.getElementById("users");
    const tokensDiv = document.getElementById("tokens");

    usersDiv.innerHTML = "";
    tokensDiv.innerHTML = "";

    if (!data.users || Object.keys(data.users).length === 0) {
      usersDiv.innerHTML = "<i>Kullanƒ±cƒ± yok</i>";
    } else {
      Object.keys(data.users).forEach(key => {
        usersDiv.innerHTML += `
          <label>
            <input type="checkbox" id="${key}" ${data.users[key] ? "checked" : ""}>
            ${key}
          </label>
        `;
      });
    }

    if (!data.userstkn || Object.keys(data.userstkn).length === 0) {
      tokensDiv.innerHTML = "<i>Login trigger yok</i>";
    } else {
      Object.keys(data.userstkn).forEach(key => {
        tokensDiv.innerHTML += `
          <label>
            <input type="checkbox" id="${key}" ${data.userstkn[key] ? "checked" : ""}>
            ${key}
          </label>
        `;
      });
    }

  } catch (e) {
    console.error(e);
    alert("JSON parse hatasƒ±!");
  }
}


/* ---------- JSON KAYDET ---------- */
async function save() {
  data.globalEnabled = document.getElementById("globalEnabled").checked;

  Object.keys(data.users).forEach(key => {
    data.users[key] = document.getElementById(key).checked;
  });

  Object.keys(data.userstkn).forEach(key => {
    data.userstkn[key] = document.getElementById(key).checked;
  });

  const content = btoa(
    unescape(encodeURIComponent(JSON.stringify(data, null, 2)))
  );

  const res = await fetch(
    `https://api.github.com/repos/${OWNER}/${REPO}/contents/${FILE_PATH}`,
    {
      method: "PUT",
      headers: {
        Authorization: `token ${GITHUB_TOKEN}`,
        "Content-Type": "application/json"
      },
      body: JSON.stringify({
        message: "control.json g√ºncellendi",
        content: content,
        sha: fileSha,
        branch: BRANCH
      })
    }
  );

  if (res.ok) {
    alert("Kaydedildi üéâ");
    loadJson();
  } else {
    alert("Kaydetme hatasƒ±");
  }
}
</script>

</body>
</html>
