<!DOCTYPE html>
<html lang="tr">
<head>
  <meta charset="UTF-8">
  <title>âš™ï¸ Control.json Editor</title>
  <style>
    body {
      font-family: Arial, sans-serif;
      background: #111;
      color: #eee;
      padding: 20px;
    }
    .hidden { display: none; }
    .box {
      border: 1px solid #333;
      padding: 15px;
      margin-bottom: 20px;
      border-radius: 8px;
    }
    label {
      display: block;
      margin: 5px 0;
    }
    button {
      padding: 10px;
      margin-top: 10px;
      cursor: pointer;
    }
  </style>
</head>
<body>

<h2>ğŸ” GiriÅŸ</h2>
<div id="loginBox" class="box">
  <input type="password" id="password" placeholder="Åifre">
  <button onclick="login()">GiriÅŸ</button>
</div>

<div id="panel" class="hidden">

  <h2>âš™ï¸ Control.json Editor</h2>

  <div class="box">
    <label>
      <input type="checkbox" id="globalEnabled">
      Global Enabled
    </label>
  </div>

  <div class="box">
    <h3>ğŸ¤– Bot Toggle</h3>
    <div id="users"></div>
  </div>

  <div class="box">
    <h3>ğŸ”‘ Login Trigger</h3>
    <div id="tokens"></div>
  </div>

  <button onclick="save()">ğŸ’¾ Kaydet</button>
</div>

<script>
/* ================== AYARLAR ================== */

const PASSWORD = "29ekim1923"; // panel ÅŸifresi

const GITHUB_TOKEN = "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";

const OWNER = "canbwhite";
const REPO = "barkod-olusturucu";
const FILE_PATH = "control.json";
const BRANCH = "main";

/* ============================================= */

let data = {};
let fileSha = "";

/* ---------- LOGIN ---------- */
function login() {
  const pass = document.getElementById("password").value;
  if (pass !== PASSWORD) {
    alert("Åifre yanlÄ±ÅŸ");
    return;
  }
  document.getElementById("loginBox").classList.add("hidden");
  document.getElementById("panel").classList.remove("hidden");
  loadJson();
}

/* ---------- JSON OKU ---------- */
async function loadJson() {
  const apiUrl = `https://api.github.com/repos/${OWNER}/${REPO}/contents/${FILE_PATH}`;

  const res = await fetch(apiUrl, {
    headers: {
      Authorization: `token ${GITHUB_TOKEN}`
    }
  });

  const json = await res.json();
  fileSha = json.sha;
  data = JSON.parse(atob(json.content));

  document.getElementById("globalEnabled").checked = data.globalEnabled;

  const usersDiv = document.getElementById("users");
  const tokensDiv = document.getElementById("tokens");

  usersDiv.innerHTML = "";
  tokensDiv.innerHTML = "";

  Object.keys(data.users).forEach(key => {
    usersDiv.innerHTML += `
      <label>
        <input type="checkbox" id="${key}" ${data.users[key] ? "checked" : ""}>
        ${key}
      </label>
    `;
  });

  Object.keys(data.userstkn).forEach(key => {
    tokensDiv.innerHTML += `
      <label>
        <input type="checkbox" id="${key}" ${data.userstkn[key] ? "checked" : ""}>
        ${key}
      </label>
    `;
  });
}

/* ---------- JSON KAYDET ---------- */
async function save() {
  data.globalEnabled = document.getElementById("globalEnabled").checked;

  Object.keys(data.users).forEach(key => {
    data.users[key] = document.getElementById(key).checked;
  });

  Object.keys(data.userstkn).forEach(key => {
    data.userstkn[key] = document.getElementById(key).checked;
  });

  const content = btoa(
    unescape(encodeURIComponent(JSON.stringify(data, null, 2)))
  );

  const res = await fetch(
    `https://api.github.com/repos/${OWNER}/${REPO}/contents/${FILE_PATH}`,
    {
      method: "PUT",
      headers: {
        Authorization: `token ${GITHUB_TOKEN}`,
        "Content-Type": "application/json"
      },
      body: JSON.stringify({
        message: "control.json gÃ¼ncellendi",
        content: content,
        sha: fileSha,
        branch: BRANCH
      })
    }
  );

  if (res.ok) {
    alert("Kaydedildi ğŸ‰");
    loadJson();
  } else {
    alert("Kaydetme hatasÄ±");
  }
}
</script>

</body>
</html>
