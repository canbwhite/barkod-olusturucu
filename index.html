<!DOCTYPE html>
<html lang="tr">
<head>
  <meta charset="UTF-8">
  <title>Remote Control Panel</title>
  <style>
    body {
      font-family: Arial, sans-serif;
      background: #111;
      color: #fff;
      padding: 20px;
    }
    input, button {
      padding: 8px;
      margin: 5px 0;
    }
    .hidden { display: none; }
    .box {
      border: 1px solid #444;
      padding: 15px;
      margin-top: 20px;
    }
    label {
      display: block;
      margin: 5px 0;
    }
  </style>
</head>
<body>

<h2>üîê Giri≈ü</h2>
<input type="password" id="password" placeholder="≈ûifre">
<button onclick="login()">Giri≈ü Yap</button>

<div id="panel" class="hidden box">
  <h2>‚öôÔ∏è Control.json Editor</h2>

  <label>
    <input type="checkbox" id="globalEnabled">
    Global Enabled
  </label>

  <h3>ü§ñ Bot Toggle</h3>
  <div id="users"></div>

  <h3>üîë Login Trigger</h3>
  <div id="tokens"></div>

  <button onclick="save()">üíæ Kaydet</button>
  <p id="status"></p>
</div>

<script>
/* ================== AYARLAR ================== */
const PASSWORD = "29ekim1923"; // panel ≈üifresi
const GITHUB_TOKEN = "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";
const OWNER = "canbwhite";
const REPO = "remote-control-panel";
const FILE_PATH = "control.json";
/* ============================================ */

let sha = "";
let data = {};

function login() {
  if (document.getElementById("password").value === PASSWORD) {
    document.getElementById("panel").classList.remove("hidden");
    loadJson();
  } else {
    alert("≈ûifre yanlƒ±≈ü");
  }
}

async function loadJson() {
  const res = await fetch(
    `https://api.github.com/repos/${OWNER}/${REPO}/contents/${FILE_PATH}`,
    {
      headers: {
        Authorization: `token ${GITHUB_TOKEN}`
      }
    }
  );
  const json = await res.json();
  sha = json.sha;
  data = JSON.parse(atob(json.content));

  document.getElementById("globalEnabled").checked = data.globalEnabled;

  const usersDiv = document.getElementById("users");
  const tokensDiv = document.getElementById("tokens");

  usersDiv.innerHTML = "";
  tokensDiv.innerHTML = "";

  Object.keys(data.users).forEach(key => {
    usersDiv.innerHTML += `
      <label>
        <input type="checkbox" id="${key}" ${data.users[key] ? "checked" : ""}>
        ${key}
      </label>
    `;
  });

  Object.keys(data.userstkn).forEach(key => {
    tokensDiv.innerHTML += `
      <label>
        <input type="checkbox" id="${key}" ${data.userstkn[key] ? "checked" : ""}>
        ${key}
      </label>
    `;
  });
}

async function save() {
  data.globalEnabled = document.getElementById("globalEnabled").checked;

  Object.keys(data.users).forEach(k => {
    data.users[k] = document.getElementById(k).checked;
  });

  Object.keys(data.userstkn).forEach(k => {
    data.userstkn[k] = document.getElementById(k).checked;
  });

  const content = btoa(JSON.stringify(data, null, 2));

  const res = await fetch(
    `https://api.github.com/repos/${OWNER}/${REPO}/contents/${FILE_PATH}`,
    {
      method: "PUT",
      headers: {
        Authorization: `token ${GITHUB_TOKEN}`,
        "Content-Type": "application/json"
      },
      body: JSON.stringify({
        message: "control.json updated from panel",
        content,
        sha
      })
    }
  );

  if (res.ok) {
    document.getElementById("status").innerText = "‚úÖ Kaydedildi";
    loadJson();
  } else {
    document.getElementById("status").innerText = "‚ùå Hata olu≈ütu";
  }
}
</script>

</body>
</html>
